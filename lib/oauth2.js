"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;


var _passportOauth = require("passport-oauth");function _typeof(obj) {if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {_typeof = function _typeof(obj) {return typeof obj;};} else {_typeof = function _typeof(obj) {return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;};}return _typeof(obj);}function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance");}function _iterableToArrayLimit(arr, i) {var _arr = [];var _n = true;var _d = false;var _e = undefined;try {for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {_arr.push(_s.value);if (i && _arr.length === i) break;}} catch (err) {_d = true;_e = err;} finally {try {if (!_n && _i["return"] != null) _i["return"]();} finally {if (_d) throw _e;}}return _arr;}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}function _createClass(Constructor, protoProps, staticProps) {if (protoProps) _defineProperties(Constructor.prototype, protoProps);if (staticProps) _defineProperties(Constructor, staticProps);return Constructor;}function _possibleConstructorReturn(self, call) {if (call && (_typeof(call) === "object" || typeof call === "function")) {return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _getPrototypeOf(o) {_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });if (superClass) _setPrototypeOf(subClass, superClass);}function _setPrototypeOf(o, p) {_setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return _setPrototypeOf(o, p);}

/**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * `Strategy` constructor.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * The ssp authentication strategy authenticates requests by
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * delegating to ssp using the OAuth 2.0 protocol.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Applications must supply a `verify` callback which accepts an `accessToken`,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * `refreshToken` and service-specific `profile`, and then calls the `done`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * callback supplying a `user`, which should be set to `false` if the
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * credentials are not valid.  If an exception occured, `err` should be set.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Options:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *   - `clientID`      your Dataporten application's client id
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *   - `clientSecret`  your Dataporten application's client secret
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *   - `callbackURL`   URL to which Dataporten will redirect the user after granting authorization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Examples:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *     passport.use(new SSPStrategy({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         authorizationURL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  clientID: '_147984a9971a8e3cfca62889fc141e155d1d5f993b',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         clientSecret: 'shhh-its-a-secret',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         callbackURL: 'https://www.example.net/auth/ssp/callback'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *       },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *       function(accessToken, refreshToken, profile, done) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         User.findOrCreate(..., function (err, user) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *           done(err, user);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *       }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *     ));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @param {Object} options
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @param {Function} verify
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @api public
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */var
Strategy = /*#__PURE__*/function (_OAuth2Strategy) {_inherits(Strategy, _OAuth2Strategy);

  function Strategy(options, verify)
  {var _this;_classCallCheck(this, Strategy);
    options = options || {};
    options.authorizationURL = options.authorizationURL || '';
    options.tokenURL = options.tokenURL || '';
    options.scopeSeparator = options.scopeSeparator || ' ';
    options.customHeaders = options.customHeaders || {};
    options.sessionKey = options.sessionKey || 'oauth:ssp';
    if (!options.customHeaders['User-Agent'])
    {
      options.customHeaders['User-Agent'] = options.userAgent || 'passport-ssp';
    }
    _this = _possibleConstructorReturn(this, _getPrototypeOf(Strategy).call(this, options, verify));

    _this.profileUrl = options.profileUrl || '';
    _this.name = 'ssp';return _this;

  }

  /**
        * Retrieve user profile from SSP.
        *
        * This function constructs a normalized profile, with the following properties:
        *
     *   - `provider`         always set to `ssp`
     *   - `id`               the user's ID
        *   - `displayName`      the user's display name
        *   - `_json`            the raw
        *
        * @param {String} accessToken
        * @param {Function} done
        * @api protected
        */_createClass(Strategy, [{ key: "userProfile", value: function userProfile(
    accessToken, done)
    {
      this._oauth2.useAuthorizationHeaderforGET(true);
      this._oauth2.get(this.profileUrl, accessToken, function (err, body, res)
      {
        if (err)
        {
          return done(err);
        } else

        {
          try
          {
            var json = JSON.parse(body);
            var profile = { provider: 'ssp' };

            if (json.hasOwnProperty('attributes'))
            {
              profile.attributes = {};
              Object.entries(json.attributes).forEach(
              function (_ref)
              {var _ref2 = _slicedToArray(_ref, 2),key = _ref2[0],value = _ref2[1];
                switch (key) {

                  case 'eduPersonPrincipalName':
                  case 'eduPersonTargetedID':
                  case 'eduPersonUniqueId':
                    profile.id = value;
                    break;

                  case 'displayName':
                    profile.displayName = value;
                    break;

                  case 'givenName':
                    profile.givenName = value;
                    break;

                  case 'sn':
                    profile.name.familyName = value;
                    break;

                  case 'mail':
                    profile['emails'] = [{ 'value': value, 'type': 'work' }];
                    break;

                  case 'jpegPhoto':
                    profile['photos'] = [{ 'value': value }];
                    break;}

                profile.attributes[key] = value;

              });
            }

            // profile._raw = body;
            // profile._json = json;
            profile._accessToken = accessToken;
            done(null, profile);
          }
          catch (e)
          {
            done(e);
          }
        }
      });
    } }]);return Strategy;}(_passportOauth.OAuth2Strategy);



/**
                                                             * Expose `Strategy`.
                                                             */var _default =
Strategy;exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vYXV0aDIuanMiXSwibmFtZXMiOlsiU3RyYXRlZ3kiLCJvcHRpb25zIiwidmVyaWZ5IiwiYXV0aG9yaXphdGlvblVSTCIsInRva2VuVVJMIiwic2NvcGVTZXBhcmF0b3IiLCJjdXN0b21IZWFkZXJzIiwic2Vzc2lvbktleSIsInVzZXJBZ2VudCIsInByb2ZpbGVVcmwiLCJuYW1lIiwiYWNjZXNzVG9rZW4iLCJkb25lIiwiX29hdXRoMiIsInVzZUF1dGhvcml6YXRpb25IZWFkZXJmb3JHRVQiLCJnZXQiLCJlcnIiLCJib2R5IiwicmVzIiwianNvbiIsIkpTT04iLCJwYXJzZSIsInByb2ZpbGUiLCJwcm92aWRlciIsImhhc093blByb3BlcnR5IiwiYXR0cmlidXRlcyIsIk9iamVjdCIsImVudHJpZXMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJpZCIsImRpc3BsYXlOYW1lIiwiZ2l2ZW5OYW1lIiwiZmFtaWx5TmFtZSIsIl9hY2Nlc3NUb2tlbiIsImUiLCJPQXV0aDJTdHJhdGVneSJdLCJtYXBwaW5ncyI6Ijs7O0FBR0EsK0M7O0FBRUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUNNQSxROztBQUVMLG9CQUFZQyxPQUFaLEVBQXFCQyxNQUFyQjtBQUNBO0FBQ0NELElBQUFBLE9BQU8sR0FBR0EsT0FBTyxJQUFJLEVBQXJCO0FBQ0FBLElBQUFBLE9BQU8sQ0FBQ0UsZ0JBQVIsR0FBMkJGLE9BQU8sQ0FBQ0UsZ0JBQVIsSUFBNEIsRUFBdkQ7QUFDQUYsSUFBQUEsT0FBTyxDQUFDRyxRQUFSLEdBQW1CSCxPQUFPLENBQUNHLFFBQVIsSUFBb0IsRUFBdkM7QUFDQUgsSUFBQUEsT0FBTyxDQUFDSSxjQUFSLEdBQXlCSixPQUFPLENBQUNJLGNBQVIsSUFBMEIsR0FBbkQ7QUFDQUosSUFBQUEsT0FBTyxDQUFDSyxhQUFSLEdBQXdCTCxPQUFPLENBQUNLLGFBQVIsSUFBeUIsRUFBakQ7QUFDQUwsSUFBQUEsT0FBTyxDQUFDTSxVQUFSLEdBQXFCTixPQUFPLENBQUNNLFVBQVIsSUFBc0IsV0FBM0M7QUFDQSxRQUFJLENBQUNOLE9BQU8sQ0FBQ0ssYUFBUixDQUFzQixZQUF0QixDQUFMO0FBQ0E7QUFDQ0wsTUFBQUEsT0FBTyxDQUFDSyxhQUFSLENBQXNCLFlBQXRCLElBQXNDTCxPQUFPLENBQUNPLFNBQVIsSUFBcUIsY0FBM0Q7QUFDQTtBQUNELGtGQUFNUCxPQUFOLEVBQWVDLE1BQWY7O0FBRUEsVUFBS08sVUFBTCxHQUFrQlIsT0FBTyxDQUFDUSxVQUFSLElBQXNCLEVBQXhDO0FBQ0EsVUFBS0MsSUFBTCxHQUFZLEtBQVosQ0FkRDs7QUFnQkM7O0FBRUQ7Ozs7Ozs7Ozs7Ozs7O0FBY1lDLElBQUFBLFcsRUFBYUMsSTtBQUN6QjtBQUNDLFdBQUtDLE9BQUwsQ0FBYUMsNEJBQWIsQ0FBMEMsSUFBMUM7QUFDQSxXQUFLRCxPQUFMLENBQWFFLEdBQWIsQ0FBaUIsS0FBS04sVUFBdEIsRUFBa0NFLFdBQWxDLEVBQStDLFVBQVNLLEdBQVQsRUFBY0MsSUFBZCxFQUFvQkMsR0FBcEI7QUFDL0M7QUFDQyxZQUFJRixHQUFKO0FBQ0E7QUFDQyxpQkFBT0osSUFBSSxDQUFDSSxHQUFELENBQVg7QUFDQSxTQUhEOztBQUtBO0FBQ0M7QUFDQTtBQUNDLGdCQUFNRyxJQUFJLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFXSixJQUFYLENBQWI7QUFDQSxnQkFBTUssT0FBTyxHQUFFLEVBQUVDLFFBQVEsRUFBRSxLQUFaLEVBQWY7O0FBRUEsZ0JBQUlKLElBQUksQ0FBQ0ssY0FBTCxDQUFvQixZQUFwQixDQUFKO0FBQ0E7QUFDQ0YsY0FBQUEsT0FBTyxDQUFDRyxVQUFSLEdBQW1CLEVBQW5CO0FBQ0FDLGNBQUFBLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlUixJQUFJLENBQUNNLFVBQXBCLEVBQWdDRyxPQUFoQztBQUNDO0FBQ0EsbURBREdDLEdBQ0gsWUFEUUMsS0FDUjtBQUNDLHdCQUFRRCxHQUFSOztBQUVDLHVCQUFLLHdCQUFMO0FBQ0EsdUJBQUsscUJBQUw7QUFDQSx1QkFBSyxtQkFBTDtBQUNDUCxvQkFBQUEsT0FBTyxDQUFDUyxFQUFSLEdBQWFELEtBQWI7QUFDQTs7QUFFRCx1QkFBSyxhQUFMO0FBQ0NSLG9CQUFBQSxPQUFPLENBQUNVLFdBQVIsR0FBc0JGLEtBQXRCO0FBQ0E7O0FBRUQsdUJBQUssV0FBTDtBQUNDUixvQkFBQUEsT0FBTyxDQUFDVyxTQUFSLEdBQW9CSCxLQUFwQjtBQUNBOztBQUVELHVCQUFLLElBQUw7QUFDQ1Isb0JBQUFBLE9BQU8sQ0FBQ1osSUFBUixDQUFhd0IsVUFBYixHQUEwQkosS0FBMUI7QUFDQTs7QUFFRCx1QkFBSyxNQUFMO0FBQ0NSLG9CQUFBQSxPQUFPLENBQUMsUUFBRCxDQUFQLEdBQW9CLENBQUUsRUFBRSxTQUFTUSxLQUFYLEVBQWtCLFFBQVEsTUFBMUIsRUFBRixDQUFwQjtBQUNBOztBQUVELHVCQUFLLFdBQUw7QUFDQ1Isb0JBQUFBLE9BQU8sQ0FBQyxRQUFELENBQVAsR0FBb0IsQ0FBRSxFQUFFLFNBQVNRLEtBQVgsRUFBRixDQUFwQjtBQUNBLDBCQTFCRjs7QUE0QkFSLGdCQUFBQSxPQUFPLENBQUNHLFVBQVIsQ0FBbUJJLEdBQW5CLElBQXdCQyxLQUF4Qjs7QUFFQSxlQWpDRjtBQWtDQTs7QUFFRDtBQUNBO0FBQ0FSLFlBQUFBLE9BQU8sQ0FBQ2EsWUFBUixHQUF1QnhCLFdBQXZCO0FBQ0FDLFlBQUFBLElBQUksQ0FBQyxJQUFELEVBQU9VLE9BQVAsQ0FBSjtBQUNBO0FBQ0QsaUJBQU9jLENBQVA7QUFDQTtBQUNDeEIsWUFBQUEsSUFBSSxDQUFDd0IsQ0FBRCxDQUFKO0FBQ0E7QUFDRDtBQUNELE9BOUREO0FBK0RBLEssdUJBckdxQkMsNkI7Ozs7QUF5R3ZCOzs7QUFHZXJDLFEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMuXG4gKi9cbmltcG9ydCB7IE9BdXRoMlN0cmF0ZWd5IH0gZnJvbSAncGFzc3BvcnQtb2F1dGgnO1xuXG4vKipcbiAqIGBTdHJhdGVneWAgY29uc3RydWN0b3IuXG4gKlxuICogVGhlIHNzcCBhdXRoZW50aWNhdGlvbiBzdHJhdGVneSBhdXRoZW50aWNhdGVzIHJlcXVlc3RzIGJ5XG4gKiBkZWxlZ2F0aW5nIHRvIHNzcCB1c2luZyB0aGUgT0F1dGggMi4wIHByb3RvY29sLlxuICpcbiAqIEFwcGxpY2F0aW9ucyBtdXN0IHN1cHBseSBhIGB2ZXJpZnlgIGNhbGxiYWNrIHdoaWNoIGFjY2VwdHMgYW4gYGFjY2Vzc1Rva2VuYCxcbiAqIGByZWZyZXNoVG9rZW5gIGFuZCBzZXJ2aWNlLXNwZWNpZmljIGBwcm9maWxlYCwgYW5kIHRoZW4gY2FsbHMgdGhlIGBkb25lYFxuICogY2FsbGJhY2sgc3VwcGx5aW5nIGEgYHVzZXJgLCB3aGljaCBzaG91bGQgYmUgc2V0IHRvIGBmYWxzZWAgaWYgdGhlXG4gKiBjcmVkZW50aWFscyBhcmUgbm90IHZhbGlkLiAgSWYgYW4gZXhjZXB0aW9uIG9jY3VyZWQsIGBlcnJgIHNob3VsZCBiZSBzZXQuXG4gKlxuICogT3B0aW9uczpcbiAqICAgLSBgY2xpZW50SURgICAgICAgeW91ciBEYXRhcG9ydGVuIGFwcGxpY2F0aW9uJ3MgY2xpZW50IGlkXG4gKiAgIC0gYGNsaWVudFNlY3JldGAgIHlvdXIgRGF0YXBvcnRlbiBhcHBsaWNhdGlvbidzIGNsaWVudCBzZWNyZXRcbiAqICAgLSBgY2FsbGJhY2tVUkxgICAgVVJMIHRvIHdoaWNoIERhdGFwb3J0ZW4gd2lsbCByZWRpcmVjdCB0aGUgdXNlciBhZnRlciBncmFudGluZyBhdXRob3JpemF0aW9uXG4gKlxuICogRXhhbXBsZXM6XG4gKlxuICogICAgIHBhc3Nwb3J0LnVzZShuZXcgU1NQU3RyYXRlZ3koe1xuICogICAgICAgICBhdXRob3JpemF0aW9uVVJMXG4gICAgICAgY2xpZW50SUQ6ICdfMTQ3OTg0YTk5NzFhOGUzY2ZjYTYyODg5ZmMxNDFlMTU1ZDFkNWY5OTNiJyxcbiAqICAgICAgICAgY2xpZW50U2VjcmV0OiAnc2hoaC1pdHMtYS1zZWNyZXQnLFxuICogICAgICAgICBjYWxsYmFja1VSTDogJ2h0dHBzOi8vd3d3LmV4YW1wbGUubmV0L2F1dGgvc3NwL2NhbGxiYWNrJ1xuICogICAgICAgfSxcbiAqICAgICAgIGZ1bmN0aW9uKGFjY2Vzc1Rva2VuLCByZWZyZXNoVG9rZW4sIHByb2ZpbGUsIGRvbmUpIHtcbiAqICAgICAgICAgVXNlci5maW5kT3JDcmVhdGUoLi4uLCBmdW5jdGlvbiAoZXJyLCB1c2VyKSB7XG4gKiAgICAgICAgICAgZG9uZShlcnIsIHVzZXIpO1xuICogICAgICAgICB9KTtcbiAqICAgICAgIH1cbiAqICAgICApKTtcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gdmVyaWZ5XG4gKiBAYXBpIHB1YmxpY1xuICovXG5jbGFzcyBTdHJhdGVneSBleHRlbmRzIE9BdXRoMlN0cmF0ZWd5XG57XG5cdGNvbnN0cnVjdG9yKG9wdGlvbnMsIHZlcmlmeSlcblx0e1xuXHRcdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXHRcdG9wdGlvbnMuYXV0aG9yaXphdGlvblVSTCA9IG9wdGlvbnMuYXV0aG9yaXphdGlvblVSTCB8fCAnJztcblx0XHRvcHRpb25zLnRva2VuVVJMID0gb3B0aW9ucy50b2tlblVSTCB8fCAnJztcblx0XHRvcHRpb25zLnNjb3BlU2VwYXJhdG9yID0gb3B0aW9ucy5zY29wZVNlcGFyYXRvciB8fCAnICc7XG5cdFx0b3B0aW9ucy5jdXN0b21IZWFkZXJzID0gb3B0aW9ucy5jdXN0b21IZWFkZXJzIHx8IHt9O1xuXHRcdG9wdGlvbnMuc2Vzc2lvbktleSA9IG9wdGlvbnMuc2Vzc2lvbktleSB8fCAnb2F1dGg6c3NwJztcblx0XHRpZiAoIW9wdGlvbnMuY3VzdG9tSGVhZGVyc1snVXNlci1BZ2VudCddKVxuXHRcdHtcblx0XHRcdG9wdGlvbnMuY3VzdG9tSGVhZGVyc1snVXNlci1BZ2VudCddID0gb3B0aW9ucy51c2VyQWdlbnQgfHwgJ3Bhc3Nwb3J0LXNzcCc7XG5cdFx0fVxuXHRcdHN1cGVyKG9wdGlvbnMsIHZlcmlmeSk7XG5cblx0XHR0aGlzLnByb2ZpbGVVcmwgPSBvcHRpb25zLnByb2ZpbGVVcmwgfHwgJyc7XG5cdFx0dGhpcy5uYW1lID0gJ3NzcCc7XG5cblx0fVxuXG5cdC8qKlxuICAgICAqIFJldHJpZXZlIHVzZXIgcHJvZmlsZSBmcm9tIFNTUC5cbiAgICAgKlxuICAgICAqIFRoaXMgZnVuY3Rpb24gY29uc3RydWN0cyBhIG5vcm1hbGl6ZWQgcHJvZmlsZSwgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6XG4gICAgICpcblx0ICogICAtIGBwcm92aWRlcmAgICAgICAgICBhbHdheXMgc2V0IHRvIGBzc3BgXG5cdCAqICAgLSBgaWRgICAgICAgICAgICAgICAgdGhlIHVzZXIncyBJRFxuICAgICAqICAgLSBgZGlzcGxheU5hbWVgICAgICAgdGhlIHVzZXIncyBkaXNwbGF5IG5hbWVcbiAgICAgKiAgIC0gYF9qc29uYCAgICAgICAgICAgIHRoZSByYXdcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBhY2Nlc3NUb2tlblxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGRvbmVcbiAgICAgKiBAYXBpIHByb3RlY3RlZFxuICAgICAqL1xuXHR1c2VyUHJvZmlsZShhY2Nlc3NUb2tlbiwgZG9uZSlcblx0e1xuXHRcdHRoaXMuX29hdXRoMi51c2VBdXRob3JpemF0aW9uSGVhZGVyZm9yR0VUKHRydWUpO1xuXHRcdHRoaXMuX29hdXRoMi5nZXQodGhpcy5wcm9maWxlVXJsLCBhY2Nlc3NUb2tlbiwgZnVuY3Rpb24oZXJyLCBib2R5LCByZXMpXG5cdFx0e1xuXHRcdFx0aWYgKGVycilcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuIGRvbmUoZXJyKTtcblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdHtcblx0XHRcdFx0dHJ5XG5cdFx0XHRcdHtcblx0XHRcdFx0XHRjb25zdCBqc29uID0gSlNPTi5wYXJzZShib2R5KTtcblx0XHRcdFx0XHRjb25zdCBwcm9maWxlPSB7IHByb3ZpZGVyOiAnc3NwJyB9O1xuXG5cdFx0XHRcdFx0aWYgKGpzb24uaGFzT3duUHJvcGVydHkoJ2F0dHJpYnV0ZXMnKSlcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRwcm9maWxlLmF0dHJpYnV0ZXM9e307XG5cdFx0XHRcdFx0XHRPYmplY3QuZW50cmllcyhqc29uLmF0dHJpYnV0ZXMpLmZvckVhY2goXG5cdFx0XHRcdFx0XHRcdChbIGtleSwgdmFsdWUgXSkgPT5cblx0XHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRcdHN3aXRjaCAoa2V5KVxuXHRcdFx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgJ2VkdVBlcnNvblByaW5jaXBhbE5hbWUnOlxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAnZWR1UGVyc29uVGFyZ2V0ZWRJRCc6XG5cdFx0XHRcdFx0XHRcdFx0XHRjYXNlICdlZHVQZXJzb25VbmlxdWVJZCc6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHByb2ZpbGUuaWQgPSB2YWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgJ2Rpc3BsYXlOYW1lJzpcblx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvZmlsZS5kaXNwbGF5TmFtZSA9IHZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAnZ2l2ZW5OYW1lJzpcblx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvZmlsZS5naXZlbk5hbWUgPSB2YWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgJ3NuJzpcblx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvZmlsZS5uYW1lLmZhbWlseU5hbWUgPSB2YWx1ZTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgJ21haWwnOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9maWxlWydlbWFpbHMnXSA9IFsgeyAndmFsdWUnOiB2YWx1ZSxcdCd0eXBlJzogJ3dvcmsnIH0gXTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgJ2pwZWdQaG90byc6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHByb2ZpbGVbJ3Bob3RvcyddID0gWyB7ICd2YWx1ZSc6IHZhbHVlIH0gXTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdHByb2ZpbGUuYXR0cmlidXRlc1trZXldPXZhbHVlO1xuXG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIHByb2ZpbGUuX3JhdyA9IGJvZHk7XG5cdFx0XHRcdFx0Ly8gcHJvZmlsZS5fanNvbiA9IGpzb247XG5cdFx0XHRcdFx0cHJvZmlsZS5fYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbjtcblx0XHRcdFx0XHRkb25lKG51bGwsIHByb2ZpbGUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhdGNoIChlKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0ZG9uZShlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cbn1cblxuLyoqXG4gKiBFeHBvc2UgYFN0cmF0ZWd5YC5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgU3RyYXRlZ3k7XG4iXX0=