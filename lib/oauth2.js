"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;


var _passportOauth = require("passport-oauth");function _typeof(obj) {if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {_typeof = function _typeof(obj) {return typeof obj;};} else {_typeof = function _typeof(obj) {return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;};}return _typeof(obj);}function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance");}function _iterableToArrayLimit(arr, i) {var _arr = [];var _n = true;var _d = false;var _e = undefined;try {for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {_arr.push(_s.value);if (i && _arr.length === i) break;}} catch (err) {_d = true;_e = err;} finally {try {if (!_n && _i["return"] != null) _i["return"]();} finally {if (_d) throw _e;}}return _arr;}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _classCallCheck(instance, Constructor) {if (!(instance instanceof Constructor)) {throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target, props) {for (var i = 0; i < props.length; i++) {var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);}}function _createClass(Constructor, protoProps, staticProps) {if (protoProps) _defineProperties(Constructor.prototype, protoProps);if (staticProps) _defineProperties(Constructor, staticProps);return Constructor;}function _possibleConstructorReturn(self, call) {if (call && (_typeof(call) === "object" || typeof call === "function")) {return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self) {if (self === void 0) {throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _getPrototypeOf(o) {_getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {return o.__proto__ || Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _inherits(subClass, superClass) {if (typeof superClass !== "function" && superClass !== null) {throw new TypeError("Super expression must either be null or a function");}subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } });if (superClass) _setPrototypeOf(subClass, superClass);}function _setPrototypeOf(o, p) {_setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {o.__proto__ = p;return o;};return _setPrototypeOf(o, p);}

/**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * `Strategy` constructor.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * The ssp authentication strategy authenticates requests by
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * delegating to ssp using the OAuth 2.0 protocol.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Applications must supply a `verify` callback which accepts an `accessToken`,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * `refreshToken` and service-specific `profile`, and then calls the `done`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * callback supplying a `user`, which should be set to `false` if the
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * credentials are not valid.  If an exception occured, `err` should be set.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Options:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *   - `clientID`      your Dataporten application's client id
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *   - `clientSecret`  your Dataporten application's client secret
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *   - `callbackURL`   URL to which Dataporten will redirect the user after granting authorization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Examples:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *     passport.use(new SSPStrategy({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         authorizationURL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  clientID: '_147984a9971a8e3cfca62889fc141e155d1d5f993b',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         clientSecret: 'shhh-its-a-secret',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         callbackURL: 'https://www.example.net/auth/ssp/callback'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *       },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *       function(accessToken, refreshToken, profile, done) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         User.findOrCreate(..., function (err, user) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *           done(err, user);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *         });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *       }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *     ));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @param {Object} options
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @param {Function} verify
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * @api public
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */var
Strategy = /*#__PURE__*/function (_OAuth2Strategy) {_inherits(Strategy, _OAuth2Strategy);

  function Strategy(options, verify)
  {var _this;_classCallCheck(this, Strategy);
    options = options || {};
    options.authorizationURL = options.authorizationURL || '';
    options.tokenURL = options.tokenURL || '';
    options.scopeSeparator = options.scopeSeparator || ' ';
    options.customHeaders = options.customHeaders || {};
    options.sessionKey = options.sessionKey || 'oauth:ssp';
    if (!options.customHeaders['User-Agent'])
    {
      options.customHeaders['User-Agent'] = options.userAgent || 'passport-ssp';
    }
    _this = _possibleConstructorReturn(this, _getPrototypeOf(Strategy).call(this, options, verify));

    _this.profileUrl = options.profileUrl || '';
    _this.name = 'ssp';return _this;

  }

  /**
        * Retrieve user profile from SSP.
        *
        * This function constructs a normalized profile, with the following properties:
        *
     *   - `provider`         always set to `ssp`
     *   - `id`               the user's ID
        *   - `displayName`      the user's display name
        *   - `_json`            the raw
        *
        * @param {String} accessToken
        * @param {Function} done
        * @api protected
        */_createClass(Strategy, [{ key: "userProfile", value: function userProfile(
    accessToken, done)
    {
      this._oauth2.useAuthorizationHeaderforGET(true);
      this._oauth2.get(this.profileUrl, accessToken, function (err, body, res)
      {
        if (err)
        {
          return done(err);
        } else

        {
          try
          {
            var json = JSON.parse(body);
            var profile = { provider: 'ssp' };

            if (json.hasOwnProperty('attributes'))
            {
              profile.attributes = {};
              Object.entries(json.attributes).forEach(
              function (_ref)
              {var _ref2 = _slicedToArray(_ref, 2),key = _ref2[0],value = _ref2[1];
                switch (key) {

                  case 'eduPersonPrincipalName':
                  case 'eduPersonTargetedID':
                  case 'eduPersonUniqueId':
                    profile.id = value;
                    break;

                  case 'displayName':
                    profile.displayName = value;
                    break;

                  case 'givenName':
                    profile.givenName = value;
                    break;

                  case 'sn':
                    profile.name.familyName = value;
                    break;

                  case 'mail':
                    value.forEach(function (email)
                    {
                      profile['emails'] = [{ 'value': email, 'type': 'work' }];
                    });
                    break;

                  case 'jpegPhoto':
                    value.forEach(function (photo)
                    {
                      profile['photos'] = [{ 'value': "data:image/jpeg;base64, ".concat(photo) }];
                    });
                    break;}

                profile.attributes[key] = value;

              });
            }

            // profile._raw = body;
            profile._json = json;
            profile._accessToken = accessToken;
            profile.serialize = function () {return profile;};
            profile.unserialize = function (user) {return user;};
            done(null, profile);
          }
          catch (e)
          {
            done(e);
          }
        }
      });
    } }]);return Strategy;}(_passportOauth.OAuth2Strategy);



/**
                                                             * Expose `Strategy`.
                                                             */var _default =
Strategy;exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9vYXV0aDIuanMiXSwibmFtZXMiOlsiU3RyYXRlZ3kiLCJvcHRpb25zIiwidmVyaWZ5IiwiYXV0aG9yaXphdGlvblVSTCIsInRva2VuVVJMIiwic2NvcGVTZXBhcmF0b3IiLCJjdXN0b21IZWFkZXJzIiwic2Vzc2lvbktleSIsInVzZXJBZ2VudCIsInByb2ZpbGVVcmwiLCJuYW1lIiwiYWNjZXNzVG9rZW4iLCJkb25lIiwiX29hdXRoMiIsInVzZUF1dGhvcml6YXRpb25IZWFkZXJmb3JHRVQiLCJnZXQiLCJlcnIiLCJib2R5IiwicmVzIiwianNvbiIsIkpTT04iLCJwYXJzZSIsInByb2ZpbGUiLCJwcm92aWRlciIsImhhc093blByb3BlcnR5IiwiYXR0cmlidXRlcyIsIk9iamVjdCIsImVudHJpZXMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJpZCIsImRpc3BsYXlOYW1lIiwiZ2l2ZW5OYW1lIiwiZmFtaWx5TmFtZSIsImVtYWlsIiwicGhvdG8iLCJfanNvbiIsIl9hY2Nlc3NUb2tlbiIsInNlcmlhbGl6ZSIsInVuc2VyaWFsaXplIiwidXNlciIsImUiLCJPQXV0aDJTdHJhdGVneSJdLCJtYXBwaW5ncyI6Ijs7O0FBR0EsK0M7O0FBRUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUNNQSxROztBQUVMLG9CQUFZQyxPQUFaLEVBQXFCQyxNQUFyQjtBQUNBO0FBQ0NELElBQUFBLE9BQU8sR0FBR0EsT0FBTyxJQUFJLEVBQXJCO0FBQ0FBLElBQUFBLE9BQU8sQ0FBQ0UsZ0JBQVIsR0FBMkJGLE9BQU8sQ0FBQ0UsZ0JBQVIsSUFBNEIsRUFBdkQ7QUFDQUYsSUFBQUEsT0FBTyxDQUFDRyxRQUFSLEdBQW1CSCxPQUFPLENBQUNHLFFBQVIsSUFBb0IsRUFBdkM7QUFDQUgsSUFBQUEsT0FBTyxDQUFDSSxjQUFSLEdBQXlCSixPQUFPLENBQUNJLGNBQVIsSUFBMEIsR0FBbkQ7QUFDQUosSUFBQUEsT0FBTyxDQUFDSyxhQUFSLEdBQXdCTCxPQUFPLENBQUNLLGFBQVIsSUFBeUIsRUFBakQ7QUFDQUwsSUFBQUEsT0FBTyxDQUFDTSxVQUFSLEdBQXFCTixPQUFPLENBQUNNLFVBQVIsSUFBc0IsV0FBM0M7QUFDQSxRQUFJLENBQUNOLE9BQU8sQ0FBQ0ssYUFBUixDQUFzQixZQUF0QixDQUFMO0FBQ0E7QUFDQ0wsTUFBQUEsT0FBTyxDQUFDSyxhQUFSLENBQXNCLFlBQXRCLElBQXNDTCxPQUFPLENBQUNPLFNBQVIsSUFBcUIsY0FBM0Q7QUFDQTtBQUNELGtGQUFNUCxPQUFOLEVBQWVDLE1BQWY7O0FBRUEsVUFBS08sVUFBTCxHQUFrQlIsT0FBTyxDQUFDUSxVQUFSLElBQXNCLEVBQXhDO0FBQ0EsVUFBS0MsSUFBTCxHQUFZLEtBQVosQ0FkRDs7QUFnQkM7O0FBRUQ7Ozs7Ozs7Ozs7Ozs7O0FBY1lDLElBQUFBLFcsRUFBYUMsSTtBQUN6QjtBQUNDLFdBQUtDLE9BQUwsQ0FBYUMsNEJBQWIsQ0FBMEMsSUFBMUM7QUFDQSxXQUFLRCxPQUFMLENBQWFFLEdBQWIsQ0FBaUIsS0FBS04sVUFBdEIsRUFBa0NFLFdBQWxDLEVBQStDLFVBQVNLLEdBQVQsRUFBY0MsSUFBZCxFQUFvQkMsR0FBcEI7QUFDL0M7QUFDQyxZQUFJRixHQUFKO0FBQ0E7QUFDQyxpQkFBT0osSUFBSSxDQUFDSSxHQUFELENBQVg7QUFDQSxTQUhEOztBQUtBO0FBQ0M7QUFDQTtBQUNDLGdCQUFNRyxJQUFJLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFXSixJQUFYLENBQWI7QUFDQSxnQkFBTUssT0FBTyxHQUFFLEVBQUVDLFFBQVEsRUFBRSxLQUFaLEVBQWY7O0FBRUEsZ0JBQUlKLElBQUksQ0FBQ0ssY0FBTCxDQUFvQixZQUFwQixDQUFKO0FBQ0E7QUFDQ0YsY0FBQUEsT0FBTyxDQUFDRyxVQUFSLEdBQW1CLEVBQW5CO0FBQ0FDLGNBQUFBLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlUixJQUFJLENBQUNNLFVBQXBCLEVBQWdDRyxPQUFoQztBQUNDO0FBQ0EsbURBREdDLEdBQ0gsWUFEUUMsS0FDUjtBQUNDLHdCQUFRRCxHQUFSOztBQUVDLHVCQUFLLHdCQUFMO0FBQ0EsdUJBQUsscUJBQUw7QUFDQSx1QkFBSyxtQkFBTDtBQUNDUCxvQkFBQUEsT0FBTyxDQUFDUyxFQUFSLEdBQWFELEtBQWI7QUFDQTs7QUFFRCx1QkFBSyxhQUFMO0FBQ0NSLG9CQUFBQSxPQUFPLENBQUNVLFdBQVIsR0FBc0JGLEtBQXRCO0FBQ0E7O0FBRUQsdUJBQUssV0FBTDtBQUNDUixvQkFBQUEsT0FBTyxDQUFDVyxTQUFSLEdBQW9CSCxLQUFwQjtBQUNBOztBQUVELHVCQUFLLElBQUw7QUFDQ1Isb0JBQUFBLE9BQU8sQ0FBQ1osSUFBUixDQUFhd0IsVUFBYixHQUEwQkosS0FBMUI7QUFDQTs7QUFFRCx1QkFBSyxNQUFMO0FBQ0NBLG9CQUFBQSxLQUFLLENBQUNGLE9BQU4sQ0FBYyxVQUFDTyxLQUFEO0FBQ2Q7QUFDQ2Isc0JBQUFBLE9BQU8sQ0FBQyxRQUFELENBQVAsR0FBb0IsQ0FBRSxFQUFFLFNBQVNhLEtBQVgsRUFBa0IsUUFBUSxNQUExQixFQUFGLENBQXBCO0FBQ0EscUJBSEQ7QUFJQTs7QUFFRCx1QkFBSyxXQUFMO0FBQ0NMLG9CQUFBQSxLQUFLLENBQUNGLE9BQU4sQ0FBYyxVQUFDUSxLQUFEO0FBQ2Q7QUFDQ2Qsc0JBQUFBLE9BQU8sQ0FBQyxRQUFELENBQVAsR0FBb0IsQ0FBRSxFQUFFLDJDQUFvQ2MsS0FBcEMsQ0FBRixFQUFGLENBQXBCO0FBQ0EscUJBSEQ7QUFJQSwwQkFoQ0Y7O0FBa0NBZCxnQkFBQUEsT0FBTyxDQUFDRyxVQUFSLENBQW1CSSxHQUFuQixJQUF3QkMsS0FBeEI7O0FBRUEsZUF2Q0Y7QUF3Q0E7O0FBRUQ7QUFDQVIsWUFBQUEsT0FBTyxDQUFDZSxLQUFSLEdBQWdCbEIsSUFBaEI7QUFDQUcsWUFBQUEsT0FBTyxDQUFDZ0IsWUFBUixHQUF1QjNCLFdBQXZCO0FBQ0FXLFlBQUFBLE9BQU8sQ0FBQ2lCLFNBQVIsR0FBb0IsWUFBTSxDQUFFLE9BQU9qQixPQUFQLENBQWlCLENBQTdDO0FBQ0FBLFlBQUFBLE9BQU8sQ0FBQ2tCLFdBQVIsR0FBc0IsVUFBQ0MsSUFBRCxFQUFVLENBQUUsT0FBT0EsSUFBUCxDQUFjLENBQWhEO0FBQ0E3QixZQUFBQSxJQUFJLENBQUMsSUFBRCxFQUFPVSxPQUFQLENBQUo7QUFDQTtBQUNELGlCQUFPb0IsQ0FBUDtBQUNBO0FBQ0M5QixZQUFBQSxJQUFJLENBQUM4QixDQUFELENBQUo7QUFDQTtBQUNEO0FBQ0QsT0F0RUQ7QUF1RUEsSyx1QkE3R3FCQyw2Qjs7OztBQWlIdkI7OztBQUdlM0MsUSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9kdWxlIGRlcGVuZGVuY2llcy5cbiAqL1xuaW1wb3J0IHsgT0F1dGgyU3RyYXRlZ3kgfSBmcm9tICdwYXNzcG9ydC1vYXV0aCc7XG5cbi8qKlxuICogYFN0cmF0ZWd5YCBjb25zdHJ1Y3Rvci5cbiAqXG4gKiBUaGUgc3NwIGF1dGhlbnRpY2F0aW9uIHN0cmF0ZWd5IGF1dGhlbnRpY2F0ZXMgcmVxdWVzdHMgYnlcbiAqIGRlbGVnYXRpbmcgdG8gc3NwIHVzaW5nIHRoZSBPQXV0aCAyLjAgcHJvdG9jb2wuXG4gKlxuICogQXBwbGljYXRpb25zIG11c3Qgc3VwcGx5IGEgYHZlcmlmeWAgY2FsbGJhY2sgd2hpY2ggYWNjZXB0cyBhbiBgYWNjZXNzVG9rZW5gLFxuICogYHJlZnJlc2hUb2tlbmAgYW5kIHNlcnZpY2Utc3BlY2lmaWMgYHByb2ZpbGVgLCBhbmQgdGhlbiBjYWxscyB0aGUgYGRvbmVgXG4gKiBjYWxsYmFjayBzdXBwbHlpbmcgYSBgdXNlcmAsIHdoaWNoIHNob3VsZCBiZSBzZXQgdG8gYGZhbHNlYCBpZiB0aGVcbiAqIGNyZWRlbnRpYWxzIGFyZSBub3QgdmFsaWQuICBJZiBhbiBleGNlcHRpb24gb2NjdXJlZCwgYGVycmAgc2hvdWxkIGJlIHNldC5cbiAqXG4gKiBPcHRpb25zOlxuICogICAtIGBjbGllbnRJRGAgICAgICB5b3VyIERhdGFwb3J0ZW4gYXBwbGljYXRpb24ncyBjbGllbnQgaWRcbiAqICAgLSBgY2xpZW50U2VjcmV0YCAgeW91ciBEYXRhcG9ydGVuIGFwcGxpY2F0aW9uJ3MgY2xpZW50IHNlY3JldFxuICogICAtIGBjYWxsYmFja1VSTGAgICBVUkwgdG8gd2hpY2ggRGF0YXBvcnRlbiB3aWxsIHJlZGlyZWN0IHRoZSB1c2VyIGFmdGVyIGdyYW50aW5nIGF1dGhvcml6YXRpb25cbiAqXG4gKiBFeGFtcGxlczpcbiAqXG4gKiAgICAgcGFzc3BvcnQudXNlKG5ldyBTU1BTdHJhdGVneSh7XG4gKiAgICAgICAgIGF1dGhvcml6YXRpb25VUkxcbiAgICAgICBjbGllbnRJRDogJ18xNDc5ODRhOTk3MWE4ZTNjZmNhNjI4ODlmYzE0MWUxNTVkMWQ1Zjk5M2InLFxuICogICAgICAgICBjbGllbnRTZWNyZXQ6ICdzaGhoLWl0cy1hLXNlY3JldCcsXG4gKiAgICAgICAgIGNhbGxiYWNrVVJMOiAnaHR0cHM6Ly93d3cuZXhhbXBsZS5uZXQvYXV0aC9zc3AvY2FsbGJhY2snXG4gKiAgICAgICB9LFxuICogICAgICAgZnVuY3Rpb24oYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiwgcHJvZmlsZSwgZG9uZSkge1xuICogICAgICAgICBVc2VyLmZpbmRPckNyZWF0ZSguLi4sIGZ1bmN0aW9uIChlcnIsIHVzZXIpIHtcbiAqICAgICAgICAgICBkb25lKGVyciwgdXNlcik7XG4gKiAgICAgICAgIH0pO1xuICogICAgICAgfVxuICogICAgICkpO1xuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSB2ZXJpZnlcbiAqIEBhcGkgcHVibGljXG4gKi9cbmNsYXNzIFN0cmF0ZWd5IGV4dGVuZHMgT0F1dGgyU3RyYXRlZ3lcbntcblx0Y29uc3RydWN0b3Iob3B0aW9ucywgdmVyaWZ5KVxuXHR7XG5cdFx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cdFx0b3B0aW9ucy5hdXRob3JpemF0aW9uVVJMID0gb3B0aW9ucy5hdXRob3JpemF0aW9uVVJMIHx8ICcnO1xuXHRcdG9wdGlvbnMudG9rZW5VUkwgPSBvcHRpb25zLnRva2VuVVJMIHx8ICcnO1xuXHRcdG9wdGlvbnMuc2NvcGVTZXBhcmF0b3IgPSBvcHRpb25zLnNjb3BlU2VwYXJhdG9yIHx8ICcgJztcblx0XHRvcHRpb25zLmN1c3RvbUhlYWRlcnMgPSBvcHRpb25zLmN1c3RvbUhlYWRlcnMgfHwge307XG5cdFx0b3B0aW9ucy5zZXNzaW9uS2V5ID0gb3B0aW9ucy5zZXNzaW9uS2V5IHx8ICdvYXV0aDpzc3AnO1xuXHRcdGlmICghb3B0aW9ucy5jdXN0b21IZWFkZXJzWydVc2VyLUFnZW50J10pXG5cdFx0e1xuXHRcdFx0b3B0aW9ucy5jdXN0b21IZWFkZXJzWydVc2VyLUFnZW50J10gPSBvcHRpb25zLnVzZXJBZ2VudCB8fCAncGFzc3BvcnQtc3NwJztcblx0XHR9XG5cdFx0c3VwZXIob3B0aW9ucywgdmVyaWZ5KTtcblxuXHRcdHRoaXMucHJvZmlsZVVybCA9IG9wdGlvbnMucHJvZmlsZVVybCB8fCAnJztcblx0XHR0aGlzLm5hbWUgPSAnc3NwJztcblxuXHR9XG5cblx0LyoqXG4gICAgICogUmV0cmlldmUgdXNlciBwcm9maWxlIGZyb20gU1NQLlxuICAgICAqXG4gICAgICogVGhpcyBmdW5jdGlvbiBjb25zdHJ1Y3RzIGEgbm9ybWFsaXplZCBwcm9maWxlLCB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczpcbiAgICAgKlxuXHQgKiAgIC0gYHByb3ZpZGVyYCAgICAgICAgIGFsd2F5cyBzZXQgdG8gYHNzcGBcblx0ICogICAtIGBpZGAgICAgICAgICAgICAgICB0aGUgdXNlcidzIElEXG4gICAgICogICAtIGBkaXNwbGF5TmFtZWAgICAgICB0aGUgdXNlcidzIGRpc3BsYXkgbmFtZVxuICAgICAqICAgLSBgX2pzb25gICAgICAgICAgICAgdGhlIHJhd1xuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGFjY2Vzc1Rva2VuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZG9uZVxuICAgICAqIEBhcGkgcHJvdGVjdGVkXG4gICAgICovXG5cdHVzZXJQcm9maWxlKGFjY2Vzc1Rva2VuLCBkb25lKVxuXHR7XG5cdFx0dGhpcy5fb2F1dGgyLnVzZUF1dGhvcml6YXRpb25IZWFkZXJmb3JHRVQodHJ1ZSk7XG5cdFx0dGhpcy5fb2F1dGgyLmdldCh0aGlzLnByb2ZpbGVVcmwsIGFjY2Vzc1Rva2VuLCBmdW5jdGlvbihlcnIsIGJvZHksIHJlcylcblx0XHR7XG5cdFx0XHRpZiAoZXJyKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm4gZG9uZShlcnIpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHR0cnlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKGJvZHkpO1xuXHRcdFx0XHRcdGNvbnN0IHByb2ZpbGU9IHsgcHJvdmlkZXI6ICdzc3AnIH07XG5cblx0XHRcdFx0XHRpZiAoanNvbi5oYXNPd25Qcm9wZXJ0eSgnYXR0cmlidXRlcycpKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdHByb2ZpbGUuYXR0cmlidXRlcz17fTtcblx0XHRcdFx0XHRcdE9iamVjdC5lbnRyaWVzKGpzb24uYXR0cmlidXRlcykuZm9yRWFjaChcblx0XHRcdFx0XHRcdFx0KFsga2V5LCB2YWx1ZSBdKSA9PlxuXHRcdFx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRcdFx0c3dpdGNoIChrZXkpXG5cdFx0XHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAnZWR1UGVyc29uUHJpbmNpcGFsTmFtZSc6XG5cdFx0XHRcdFx0XHRcdFx0XHRjYXNlICdlZHVQZXJzb25UYXJnZXRlZElEJzpcblx0XHRcdFx0XHRcdFx0XHRcdGNhc2UgJ2VkdVBlcnNvblVuaXF1ZUlkJzpcblx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvZmlsZS5pZCA9IHZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAnZGlzcGxheU5hbWUnOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9maWxlLmRpc3BsYXlOYW1lID0gdmFsdWU7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRjYXNlICdnaXZlbk5hbWUnOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9maWxlLmdpdmVuTmFtZSA9IHZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAnc24nOlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9maWxlLm5hbWUuZmFtaWx5TmFtZSA9IHZhbHVlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAnbWFpbCc6XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhbHVlLmZvckVhY2goKGVtYWlsKSA9PlxuXHRcdFx0XHRcdFx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvZmlsZVsnZW1haWxzJ10gPSBbIHsgJ3ZhbHVlJzogZW1haWwsXHQndHlwZSc6ICd3b3JrJyB9IF07XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FzZSAnanBlZ1Bob3RvJzpcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFsdWUuZm9yRWFjaCgocGhvdG8pID0+XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9maWxlWydwaG90b3MnXSA9IFsgeyAndmFsdWUnOiBgZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwgJHtwaG90b31gIH0gXTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRwcm9maWxlLmF0dHJpYnV0ZXNba2V5XT12YWx1ZTtcblxuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBwcm9maWxlLl9yYXcgPSBib2R5O1xuXHRcdFx0XHRcdHByb2ZpbGUuX2pzb24gPSBqc29uO1xuXHRcdFx0XHRcdHByb2ZpbGUuX2FjY2Vzc1Rva2VuID0gYWNjZXNzVG9rZW47XG5cdFx0XHRcdFx0cHJvZmlsZS5zZXJpYWxpemUgPSAoKSA9PiB7IHJldHVybiBwcm9maWxlOyB9O1xuXHRcdFx0XHRcdHByb2ZpbGUudW5zZXJpYWxpemUgPSAodXNlcikgPT4geyByZXR1cm4gdXNlcjsgfTtcblx0XHRcdFx0XHRkb25lKG51bGwsIHByb2ZpbGUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhdGNoIChlKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0ZG9uZShlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cbn1cblxuLyoqXG4gKiBFeHBvc2UgYFN0cmF0ZWd5YC5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgU3RyYXRlZ3k7XG4iXX0=